{% load static %}
<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="{% static 'estilo.css' %}">
    <title>Login - Mindhub</title>
</head>

<body class="login-page">
    <div class="login-backdrop"></div>

    <div class="login-card">
        <div class="login-brand">
            <h1 class="login-logo">MINDHUB</h1>
            <p class="login-powered">Powered by Mindlink</p>
        </div>

        <form class="login-form" id="login-form">
            <label class="login-label">E-mail</label>
            <input type="email" class="input_login" id="email" placeholder="seu@email.com" autocomplete="email">
            <label class="login-label">Senha</label>
            <input type="password" class="input_login" id="password" placeholder="sua senha"
                autocomplete="current-password">
            <button type="button" class="input_btn" id="login_btn">Entrar</button>
        </form>
    </div>

    <audio id="login-sound" src="https://assets.mixkit.co/active_storage/sfx/2571/2571-preview.mp3"
        preload="auto"></audio>

    <script>
        const botao = document.querySelector('#login_btn');
        const som = document.querySelector('#login-sound');

        botao.addEventListener('click', async () => {
            const email = document.querySelector('#email').value;
            const senha = document.querySelector('#password').value;

            try {
                const resposta = await fetch('/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': '{{ csrf_token }}'
                    },
                    body: JSON.stringify({ email, senha })
                });

                const dados = await resposta.json();

                if (resposta.ok) {
                    som.play();
                    document.body.classList.add('fade-out');
                    const role = dados.role || '';
                    let url = '/mapa/'; // Default para ALUNO
                    if (role === 'ADMIN' || role === 'MONITOR') {
                        url = '/monitor/';
                    } else if (role === 'COMERCIAL') {
                        url = '/gerenciar-acessos/';
                    }
                    setTimeout(() => { window.location.href = url; }, 1200);
                } else {
                    alert(dados.mensagem || "Credenciais inválidas");
                }
            } catch (erro) {
                console.error("Erro na requisição:", erro);
                alert("Erro ao conectar com o servidor.");
            }
        });
    </script>
</body>

</html>